
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <title>RetrieveUserProxyAgent · Agentic Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.0.3">
        <meta name="author" content="AutoGen Team">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="vectordb-protocol.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../foundations-of-agents-and-messages/">
            
                <a href="../foundations-of-agents-and-messages/">
            
                    
                    Foundations of Agents and Messages
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../foundations-of-agents-and-messages/agent-protocol.html">
            
                <a href="../foundations-of-agents-and-messages/agent-protocol.html">
            
                    
                    Agent Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../foundations-of-agents-and-messages/llmagent.html">
            
                <a href="../foundations-of-agents-and-messages/llmagent.html">
            
                    
                    LLM Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../foundations-of-agents-and-messages/conversableagent.html">
            
                <a href="../foundations-of-agents-and-messages/conversableagent.html">
            
                    
                    Conversable Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../foundations-of-agents-and-messages/basemessage-and-message-serialization.html">
            
                <a href="../foundations-of-agents-and-messages/basemessage-and-message-serialization.html">
            
                    
                    BaseMessage and Message Serialization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../conversable-agent-workflow/">
            
                <a href="../conversable-agent-workflow/">
            
                    
                    Conversable Agent Workflow
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../conversable-agent-workflow/reply-function-registration.html">
            
                <a href="../conversable-agent-workflow/reply-function-registration.html">
            
                    
                    Reply Function Registration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../conversable-agent-workflow/chat-message-flow.html">
            
                <a href="../conversable-agent-workflow/chat-message-flow.html">
            
                    
                    Chat Message Flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../conversable-agent-workflow/human-input-modes.html">
            
                <a href="../conversable-agent-workflow/human-input-modes.html">
            
                    
                    Human Input Modes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../tools-and-dependency-injection/">
            
                <a href="../tools-and-dependency-injection/">
            
                    
                    Tools and Dependency Injection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../tools-and-dependency-injection/tool-abstraction.html">
            
                <a href="../tools-and-dependency-injection/tool-abstraction.html">
            
                    
                    Tool Abstraction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../tools-and-dependency-injection/toolkit.html">
            
                <a href="../tools-and-dependency-injection/toolkit.html">
            
                    
                    Toolkit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../tools-and-dependency-injection/dependency-injection-with-depends.html">
            
                <a href="../tools-and-dependency-injection/dependency-injection-with-depends.html">
            
                    
                    Dependency Injection with Depends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../tools-and-dependency-injection/context-parameter-injection.html">
            
                <a href="../tools-and-dependency-injection/context-parameter-injection.html">
            
                    
                    Context Parameter Injection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../llm-configuration-and-model-clients/">
            
                <a href="../llm-configuration-and-model-clients/">
            
                    
                    LLM Configuration and Model Clients
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../llm-configuration-and-model-clients/llmconfig-and-llmconfigentry.html">
            
                <a href="../llm-configuration-and-model-clients/llmconfig-and-llmconfigentry.html">
            
                    
                    LLMConfig and LLMConfigEntry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../llm-configuration-and-model-clients/modelclient-protocol.html">
            
                <a href="../llm-configuration-and-model-clients/modelclient-protocol.html">
            
                    
                    ModelClient Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../llm-configuration-and-model-clients/config-list-and-filtering.html">
            
                <a href="../llm-configuration-and-model-clients/config-list-and-filtering.html">
            
                    
                    Config List and Filtering
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../advanced-agent-orchestration/">
            
                <a href="../advanced-agent-orchestration/">
            
                    
                    Advanced Agent Orchestration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../advanced-agent-orchestration/groupchat-and-groupchatmanager.html">
            
                <a href="../advanced-agent-orchestration/groupchat-and-groupchatmanager.html">
            
                    
                    GroupChat and GroupChatManager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../advanced-agent-orchestration/patterns-for-orchestration-(auto,-manual,-roundrobin,-random">
            
                <span>
            
                    
                    Patterns for Orchestration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../advanced-agent-orchestration/speaker-selection-methods.html">
            
                <a href="../advanced-agent-orchestration/speaker-selection-methods.html">
            
                    
                    Speaker Selection Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../advanced-agent-orchestration/transitiontarget-and-handoff-conditions.html">
            
                <a href="../advanced-agent-orchestration/transitiontarget-and-handoff-conditions.html">
            
                    
                    TransitionTarget and Handoff Conditions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../context-variables-and-conditional-logic/">
            
                <a href="../context-variables-and-conditional-logic/">
            
                    
                    Context Variables and Conditional Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../context-variables-and-conditional-logic/contextvariables.html">
            
                <a href="../context-variables-and-conditional-logic/contextvariables.html">
            
                    
                    Context Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../context-variables-and-conditional-logic/contextcondition-and-availablecondition.html">
            
                <a href="../context-variables-and-conditional-logic/contextcondition-and-availablecondition.html">
            
                    
                    ContextCondition and AvailableCondition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../context-variables-and-conditional-logic/oncondition-and-oncontextcondition.html">
            
                <a href="../context-variables-and-conditional-logic/oncondition-and-oncontextcondition.html">
            
                    
                    OnCondition and OnContextCondition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../context-variables-and-conditional-logic/contextexpression.html">
            
                <a href="../context-variables-and-conditional-logic/contextexpression.html">
            
                    
                    Context Expression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../tool-and-function-interoperability/">
            
                <a href="../tool-and-function-interoperability/">
            
                    
                    Tool and Function Interoperability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../tool-and-function-interoperability/interoperable-protocol.html">
            
                <a href="../tool-and-function-interoperability/interoperable-protocol.html">
            
                    
                    Interoperable Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../tool-and-function-interoperability/interoperability-registry.html">
            
                <a href="../tool-and-function-interoperability/interoperability-registry.html">
            
                    
                    Interoperability Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../tool-and-function-interoperability/langchain-and-crewai-tool-conversion.html">
            
                <a href="../tool-and-function-interoperability/langchain-and-crewai-tool-conversion.html">
            
                    
                    LangChain and CrewAI Tool Conversion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../tool-and-function-interoperability/pydantic-ai-tool-integration.html">
            
                <a href="../tool-and-function-interoperability/pydantic-ai-tool-integration.html">
            
                    
                    Pydantic AI Tool Integration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="./">
            
                <a href="./">
            
                    
                    Retrieval Augmented Generation and Vector Databases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.9.1" data-path="retrieveuserproxyagent.html">
            
                <a href="retrieveuserproxyagent.html">
            
                    
                    RetrieveUserProxyAgent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="vectordb-protocol.html">
            
                <a href="vectordb-protocol.html">
            
                    
                    VectorDB Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="chromadb-pgvector-qdrant-mongodb-integrations.html">
            
                <a href="chromadb-pgvector-qdrant-mongodb-integrations.html">
            
                    
                    ChromaDB PGVector Qdrant MongoDB Integrations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="querying-and-chunking-strategies.html">
            
                <a href="querying-and-chunking-strategies.html">
            
                    
                    Querying and Chunking Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../structured-outputs-and-tool-calling-with-llms/">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/">
            
                    
                    Structured Outputs and Tool Calling with LLMs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.html">
            
                    
                    Function and Tool Schemas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../structured-outputs-and-tool-calling-with-llms/structured-output-formatting.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/structured-output-formatting.html">
            
                    
                    Structured Output Formatting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.html">
            
                    
                    Tool Call and Function Call Message Handling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../multimodal-and-vision-capabilities/">
            
                <a href="../multimodal-and-vision-capabilities/">
            
                    
                    Multimodal and Vision Capabilities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../multimodal-and-vision-capabilities/multimodalconversableagent.html">
            
                <a href="../multimodal-and-vision-capabilities/multimodalconversableagent.html">
            
                    
                    Multimodal Conversable Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../multimodal-and-vision-capabilities/visioncapability.html">
            
                <a href="../multimodal-and-vision-capabilities/visioncapability.html">
            
                    
                    Vision Capability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../multimodal-and-vision-capabilities/image-generation-and-captioning-tools.html">
            
                <a href="../multimodal-and-vision-capabilities/image-generation-and-captioning-tools.html">
            
                    
                    Image Generation and Captioning Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../multimodal-and-vision-capabilities/content-formatting-for-images.html">
            
                <a href="../multimodal-and-vision-capabilities/content-formatting-for-images.html">
            
                    
                    Content Formatting for Images
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../agent-capabilities-and-composability/">
            
                <a href="../agent-capabilities-and-composability/">
            
                    
                    Agent Capabilities and Composability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../agent-capabilities-and-composability/agentcapability-base-class.html">
            
                <a href="../agent-capabilities-and-composability/agentcapability-base-class.html">
            
                    
                    AgentCapability Base Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../agent-capabilities-and-composability/teachability-and-memory.html">
            
                <a href="../agent-capabilities-and-composability/teachability-and-memory.html">
            
                    
                    Teachability and Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../agent-capabilities-and-composability/toolscapability-composition.html">
            
                <a href="../agent-capabilities-and-composability/toolscapability-composition.html">
            
                    
                    ToolsCapability Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../agent-capabilities-and-composability/transformmessages-and-message-transforms.html">
            
                <a href="../agent-capabilities-and-composability/transformmessages-and-message-transforms.html">
            
                    
                    TransformMessages and Message Transforms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../group-and-swarm-agent-patterns/">
            
                <a href="../group-and-swarm-agent-patterns/">
            
                    
                    Group and Swarm Agent Patterns
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../group-and-swarm-agent-patterns/swarmagent-and-afterwork.html">
            
                <a href="../group-and-swarm-agent-patterns/swarmagent-and-afterwork.html">
            
                    
                    SwarmAgent and AfterWork
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../group-and-swarm-agent-patterns/oncondition-and-nested-chat-transitions.html">
            
                <a href="../group-and-swarm-agent-patterns/oncondition-and-nested-chat-transitions.html">
            
                    
                    OnCondition and Nested Chat Transitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../group-and-swarm-agent-patterns/pattern-classes-for-orchestration.html">
            
                <a href="../group-and-swarm-agent-patterns/pattern-classes-for-orchestration.html">
            
                    
                    Pattern Classes for Orchestration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../practical-pitfalls-and-best-practices/">
            
                <a href="../practical-pitfalls-and-best-practices/">
            
                    
                    Practical Pitfalls and Best Practices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../practical-pitfalls-and-best-practices/error-handling-in-agent-orchestration.html">
            
                <a href="../practical-pitfalls-and-best-practices/error-handling-in-agent-orchestration.html">
            
                    
                    Error Handling in Agent Orchestration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../practical-pitfalls-and-best-practices/security-considerations-for-code-execution.html">
            
                <a href="../practical-pitfalls-and-best-practices/security-considerations-for-code-execution.html">
            
                    
                    Security Considerations for Code Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="../practical-pitfalls-and-best-practices/testing-and-logging-strategies.html">
            
                <a href="../practical-pitfalls-and-best-practices/testing-and-logging-strategies.html">
            
                    
                    Testing and Logging Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >RetrieveUserProxyAgent</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="retrieveuserproxyagent">RetrieveUserProxyAgent</h1>
<h2 id="overview">Overview</h2>
<p>The <strong>RetrieveUserProxyAgent</strong> is a specialized agent pattern used in Retrieval Augmented Generation (RAG) systems, enabling intelligent search and retrieval of relevant information from large document collections or knowledge bases. By interfacing with vector databases, the agent can efficiently fetch contextually similar documents or chunks, which are then used to augment generative models (like LLMs) for more accurate, grounded responses. RetrieveUserProxyAgent acts as an orchestrator that manages user queries, interacts with retrieval tools (e.g., vector search APIs), and applies logic for context-informed generation.</p>
<hr></hr>
<h2 id="explanation">Explanation</h2>
<p>The RetrieveUserProxyAgent sits at the core of a RAG pipeline, bridging user input with backend retrieval and generation functionality. Its main responsibilities include:</p>
<ol>
<li><strong>Processing User Queries</strong>: Accepts natural language queries and applies necessary pre-processing, such as chunking or tokenization.</li>
<li><strong>Interfacing with Vector Databases</strong>: Converts queries into vector embeddings and searches against vector databases (e.g., Pinecone, FAISS, ChromaDB) for semantically similar documents or passages.</li>
<li><strong>Contextual Retrieval</strong>: Uses conditional logic and context variables to refine retrieval results, ensuring relevance to the user's intent.</li>
<li><strong>Augmenting Generation</strong>: Supplies retrieved content as context to a generative model (e.g., GPT-4), enabling grounded and contextualized responses.</li>
<li><strong>Tool and Function Interoperability</strong>: Orchestrates and integrates multiple tools—embedding models, vector stores, and LLMs—often by invoking specific functions or APIs.</li>
</ol>
<h3 id="example-flow">Example Flow</h3>
<ol>
<li><strong>User Query</strong>: "What were the main findings of the 2023 climate report?"</li>
<li><strong>Embedding &amp; Vector Search</strong>: Query embedded and matched against document chunks in the vector DB.</li>
<li><strong>Retrieval</strong>: Top-k relevant passages retrieved.</li>
<li><strong>Context Assembly</strong>: Chosen passages assembled as additional context.</li>
<li><strong>Generation</strong>: LLM generates a response using both user query and retrieved context.</li>
</ol>
<h3 id="chunking-and-tokenization">Chunking and Tokenization</h3>
<p>Efficient retrieval often requires documents to be split (chunked) into overlapping or non-overlapping segments, ensuring that each chunk fits within model or database token limitations while preserving context. Tokenization strategies are chosen to balance retrieval granularity and performance.</p>
<hr></hr>
<h2 id="examples">Examples</h2>
<h3 id="example-1-simple-retrieveuserproxyagent-workflow-python-pseudocode">Example 1: Simple RetrieveUserProxyAgent Workflow (Python Pseudocode)</h3>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> my_agent_framework <span class="hljs-keyword">import</span> RetrieveUserProxyAgent
<span class="hljs-keyword">from</span> my_vector_db <span class="hljs-keyword">import</span> VectorStore
<span class="hljs-keyword">from</span> my_embedding_model <span class="hljs-keyword">import</span> EmbeddingModel
<span class="hljs-keyword">from</span> my_llm <span class="hljs-keyword">import</span> LLM

<span class="hljs-comment"># Initialize components</span>
embedding_model = EmbeddingModel()
vector_store = VectorStore(index_name=<span class="hljs-string">"knowledge_base"</span>)
llm = LLM(model_name=<span class="hljs-string">"gpt-4"</span>)

<span class="hljs-comment"># Define the agent</span>
agent = RetrieveUserProxyAgent(
    embedding_model=embedding_model,
    vector_store=vector_store,
    llm=llm,
    chunk_size=<span class="hljs-number">512</span>,  <span class="hljs-comment"># tokens per chunk</span>
    overlap=<span class="hljs-number">64</span>,      <span class="hljs-comment"># token overlap</span>
)

<span class="hljs-comment"># User query</span>
query = <span class="hljs-string">"Summarize the key findings from the 2023 climate report."</span>

<span class="hljs-comment"># Agent processes the query</span>
response = agent.generate(query)

<span class="hljs-built_in">print</span>(response)
</code></pre>
<h3 id="example-2-custom-chunking-and-conditional-logic">Example 2: Custom Chunking and Conditional Logic</h3>
<pre><code class="lang-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_chunk</span>(<span class="hljs-params">document, max_tokens=<span class="hljs-number">512</span>, overlap=<span class="hljs-number">64</span></span>):
    <span class="hljs-comment"># Your custom chunking logic</span>
    <span class="hljs-comment"># Returns a list of text chunks</span>
    <span class="hljs-keyword">pass</span>

agent = RetrieveUserProxyAgent(
    ...,
    chunker=custom_chunk,
    retrieval_filter=<span class="hljs-keyword">lambda</span> chunk, query: <span class="hljs-string">"climate"</span> <span class="hljs-keyword">in</span> chunk.lower() <span class="hljs-keyword">or</span> <span class="hljs-string">"2023"</span> <span class="hljs-keyword">in</span> chunk,
)
</code></pre>
<h3 id="example-3-tool-interoperability">Example 3: Tool Interoperability</h3>
<pre><code class="lang-python"><span class="hljs-comment"># Using different vector backends</span>
vector_store = PineconeVectorStore(api_key=<span class="hljs-string">"..."</span>)
agent = RetrieveUserProxyAgent(vector_store=vector_store, ...)

<span class="hljs-comment"># Using a different embedding model</span>
embedding_model = OpenAIEmbeddingModel(api_key=<span class="hljs-string">"..."</span>)
agent.embedding_model = embedding_model
</code></pre>
<hr></hr>
<h2 id="best-practices">Best Practices</h2>
<ul>
<li><strong>Chunk Size Tuning</strong>: Optimize chunk size and overlap to balance recall and precision; too small loses context, too large may miss details.</li>
<li><strong>Tokenization Consistency</strong>: Ensure the same tokenization method is used during both document indexing and query time.</li>
<li><strong>Backend Flexibility</strong>: Design agents to easily switch between vector backends (e.g., FAISS, Pinecone, ChromaDB) as requirements evolve.</li>
<li><strong>Context Window Awareness</strong>: Be mindful of model input size limits when assembling retrieved context for the generative model.</li>
<li><strong>Conditional Retrieval</strong>: Use context variables and custom filters to fine-tune which chunks are considered relevant.</li>
<li><strong>Evaluate Retrieval Quality</strong>: Regularly benchmark retrieval results and tune scoring thresholds.</li>
</ul>
<p><strong>Common Pitfalls:</strong></p>
<ul>
<li>Indexing and querying with different embedding models or tokenization schemes.</li>
<li>Ignoring context window limits, leading to truncated or incomplete prompts.</li>
<li>Over-reliance on retrieval without validating factuality in generation.</li>
</ul>
<hr></hr>
<h2 id="related-concepts">Related Concepts</h2>
<ul>
<li><a href="https://huggingface.co/docs/transformers/main/en/tasks/rag" target="_blank">Retrieval Augmented Generation (RAG)</a></li>
<li><a href="https://www.pinecone.io/learn/vector-database/" target="_blank">Vector Databases (e.g., Pinecone, FAISS, ChromaDB)</a></li>
<li><a href="https://docs.langchain.com/docs/modules/data_connection/text_embedding/chunking/" target="_blank">Chunking and Tokenization Strategies</a></li>
<li><a href="tool_function_interoperability.md">Tool/Function Interoperability</a></li>
<li><a href="context_variables_conditional_logic.md">Context Variables and Conditional Logic</a></li>
<li><a href="https://www.promptingguide.ai/techniques/contextual-prompting" target="_blank">Prompt Engineering for RAG</a></li>
<li><a href="https://platform.openai.com/docs/guides/embeddings" target="_blank">OpenAI Embeddings API</a></li>
</ul>
<p>For further reading, see:</p>
<ul>
<li><a href="https://python.langchain.com/docs/use_cases/question_answering/" target="_blank">LangChain: Retrieval-Augmented Generation</a></li>
<li><a href="https://haystack.deepset.ai/tutorials/rag" target="_blank">Haystack: Building RAG Pipelines</a></li>
</ul>
<hr></hr>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Retrieval Augmented Generation and Vector Databases">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="vectordb-protocol.html" class="navigation navigation-next " aria-label="Next page: VectorDB Protocol">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"RetrieveUserProxyAgent","level":"1.9.1","depth":2,"next":{"title":"VectorDB Protocol","level":"1.9.2","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/vectordb-protocol.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/vectordb-protocol.md","articles":[]},"previous":{"title":"Retrieval Augmented Generation and Vector Databases","level":"1.9","depth":1,"path":"chapters/retrieval-augmented-generation-and-vector-databases/README.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/README.md","articles":[{"title":"RetrieveUserProxyAgent","level":"1.9.1","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/retrieveuserproxyagent.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/retrieveuserproxyagent.md","articles":[]},{"title":"VectorDB Protocol","level":"1.9.2","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/vectordb-protocol.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/vectordb-protocol.md","articles":[]},{"title":"ChromaDB PGVector Qdrant MongoDB Integrations","level":"1.9.3","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/chromadb-pgvector-qdrant-mongodb-integrations.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/chromadb-pgvector-qdrant-mongodb-integrations.md","articles":[]},{"title":"Querying and Chunking Strategies","level":"1.9.4","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/querying-and-chunking-strategies.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/querying-and-chunking-strategies.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["theme-default","highlight"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"AutoGen Team","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Agentic Documentation","language":"en","gitbook":"*"},"file":{"path":"chapters/retrieval-augmented-generation-and-vector-databases/retrieveuserproxyagent.md","mtime":"2025-05-24T00:01:16.629Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-05-24T00:01:26.122Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

