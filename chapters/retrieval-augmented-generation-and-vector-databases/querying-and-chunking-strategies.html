
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <title>Querying and Chunking Strategies Â· Agentic Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.0.3">
        <meta name="author" content="AutoGen Team">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../structured-outputs-and-tool-calling-with-llms/" />
    
    
    <link rel="prev" href="chromadb-pgvector-qdrant-mongodb-integrations.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../foundations-of-agents-and-messages/">
            
                <a href="../foundations-of-agents-and-messages/">
            
                    
                    Foundations of Agents and Messages
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../foundations-of-agents-and-messages/agent-protocol.html">
            
                <a href="../foundations-of-agents-and-messages/agent-protocol.html">
            
                    
                    Agent Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../foundations-of-agents-and-messages/llmagent.html">
            
                <a href="../foundations-of-agents-and-messages/llmagent.html">
            
                    
                    LLM Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../foundations-of-agents-and-messages/conversableagent.html">
            
                <a href="../foundations-of-agents-and-messages/conversableagent.html">
            
                    
                    Conversable Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../foundations-of-agents-and-messages/basemessage-and-message-serialization.html">
            
                <a href="../foundations-of-agents-and-messages/basemessage-and-message-serialization.html">
            
                    
                    BaseMessage and Message Serialization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../conversable-agent-workflow/">
            
                <a href="../conversable-agent-workflow/">
            
                    
                    Conversable Agent Workflow
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../conversable-agent-workflow/reply-function-registration.html">
            
                <a href="../conversable-agent-workflow/reply-function-registration.html">
            
                    
                    Reply Function Registration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../conversable-agent-workflow/chat-message-flow.html">
            
                <a href="../conversable-agent-workflow/chat-message-flow.html">
            
                    
                    Chat Message Flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../conversable-agent-workflow/human-input-modes.html">
            
                <a href="../conversable-agent-workflow/human-input-modes.html">
            
                    
                    Human Input Modes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../tools-and-dependency-injection/">
            
                <a href="../tools-and-dependency-injection/">
            
                    
                    Tools and Dependency Injection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../tools-and-dependency-injection/tool-abstraction.html">
            
                <a href="../tools-and-dependency-injection/tool-abstraction.html">
            
                    
                    Tool Abstraction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../tools-and-dependency-injection/toolkit.html">
            
                <a href="../tools-and-dependency-injection/toolkit.html">
            
                    
                    Toolkit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../tools-and-dependency-injection/dependency-injection-with-depends.html">
            
                <a href="../tools-and-dependency-injection/dependency-injection-with-depends.html">
            
                    
                    Dependency Injection with Depends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../tools-and-dependency-injection/context-parameter-injection.html">
            
                <a href="../tools-and-dependency-injection/context-parameter-injection.html">
            
                    
                    Context Parameter Injection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../llm-configuration-and-model-clients/">
            
                <a href="../llm-configuration-and-model-clients/">
            
                    
                    LLM Configuration and Model Clients
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../llm-configuration-and-model-clients/llmconfig-and-llmconfigentry.html">
            
                <a href="../llm-configuration-and-model-clients/llmconfig-and-llmconfigentry.html">
            
                    
                    LLMConfig and LLMConfigEntry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../llm-configuration-and-model-clients/modelclient-protocol.html">
            
                <a href="../llm-configuration-and-model-clients/modelclient-protocol.html">
            
                    
                    ModelClient Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../llm-configuration-and-model-clients/config-list-and-filtering.html">
            
                <a href="../llm-configuration-and-model-clients/config-list-and-filtering.html">
            
                    
                    Config List and Filtering
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../advanced-agent-orchestration/">
            
                <a href="../advanced-agent-orchestration/">
            
                    
                    Advanced Agent Orchestration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../advanced-agent-orchestration/groupchat-and-groupchatmanager.html">
            
                <a href="../advanced-agent-orchestration/groupchat-and-groupchatmanager.html">
            
                    
                    GroupChat and GroupChatManager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../advanced-agent-orchestration/patterns-for-orchestration-(auto,-manual,-roundrobin,-random">
            
                <span>
            
                    
                    Patterns for Orchestration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../advanced-agent-orchestration/speaker-selection-methods.html">
            
                <a href="../advanced-agent-orchestration/speaker-selection-methods.html">
            
                    
                    Speaker Selection Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../advanced-agent-orchestration/transitiontarget-and-handoff-conditions.html">
            
                <a href="../advanced-agent-orchestration/transitiontarget-and-handoff-conditions.html">
            
                    
                    TransitionTarget and Handoff Conditions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../context-variables-and-conditional-logic/">
            
                <a href="../context-variables-and-conditional-logic/">
            
                    
                    Context Variables and Conditional Logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../context-variables-and-conditional-logic/contextvariables.html">
            
                <a href="../context-variables-and-conditional-logic/contextvariables.html">
            
                    
                    Context Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../context-variables-and-conditional-logic/contextcondition-and-availablecondition.html">
            
                <a href="../context-variables-and-conditional-logic/contextcondition-and-availablecondition.html">
            
                    
                    ContextCondition and AvailableCondition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../context-variables-and-conditional-logic/oncondition-and-oncontextcondition.html">
            
                <a href="../context-variables-and-conditional-logic/oncondition-and-oncontextcondition.html">
            
                    
                    OnCondition and OnContextCondition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../context-variables-and-conditional-logic/contextexpression.html">
            
                <a href="../context-variables-and-conditional-logic/contextexpression.html">
            
                    
                    Context Expression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../tool-and-function-interoperability/">
            
                <a href="../tool-and-function-interoperability/">
            
                    
                    Tool and Function Interoperability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../tool-and-function-interoperability/interoperable-protocol.html">
            
                <a href="../tool-and-function-interoperability/interoperable-protocol.html">
            
                    
                    Interoperable Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../tool-and-function-interoperability/interoperability-registry.html">
            
                <a href="../tool-and-function-interoperability/interoperability-registry.html">
            
                    
                    Interoperability Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../tool-and-function-interoperability/langchain-and-crewai-tool-conversion.html">
            
                <a href="../tool-and-function-interoperability/langchain-and-crewai-tool-conversion.html">
            
                    
                    LangChain and CrewAI Tool Conversion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../tool-and-function-interoperability/pydantic-ai-tool-integration.html">
            
                <a href="../tool-and-function-interoperability/pydantic-ai-tool-integration.html">
            
                    
                    Pydantic AI Tool Integration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="./">
            
                <a href="./">
            
                    
                    Retrieval Augmented Generation and Vector Databases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="retrieveuserproxyagent.html">
            
                <a href="retrieveuserproxyagent.html">
            
                    
                    RetrieveUserProxyAgent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="vectordb-protocol.html">
            
                <a href="vectordb-protocol.html">
            
                    
                    VectorDB Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="chromadb-pgvector-qdrant-mongodb-integrations.html">
            
                <a href="chromadb-pgvector-qdrant-mongodb-integrations.html">
            
                    
                    ChromaDB PGVector Qdrant MongoDB Integrations
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.4" data-path="querying-and-chunking-strategies.html">
            
                <a href="querying-and-chunking-strategies.html">
            
                    
                    Querying and Chunking Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../structured-outputs-and-tool-calling-with-llms/">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/">
            
                    
                    Structured Outputs and Tool Calling with LLMs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.html">
            
                    
                    Function and Tool Schemas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../structured-outputs-and-tool-calling-with-llms/structured-output-formatting.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/structured-output-formatting.html">
            
                    
                    Structured Output Formatting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.html">
            
                <a href="../structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.html">
            
                    
                    Tool Call and Function Call Message Handling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../multimodal-and-vision-capabilities/">
            
                <a href="../multimodal-and-vision-capabilities/">
            
                    
                    Multimodal and Vision Capabilities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../multimodal-and-vision-capabilities/multimodalconversableagent.html">
            
                <a href="../multimodal-and-vision-capabilities/multimodalconversableagent.html">
            
                    
                    Multimodal Conversable Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../multimodal-and-vision-capabilities/visioncapability.html">
            
                <a href="../multimodal-and-vision-capabilities/visioncapability.html">
            
                    
                    Vision Capability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../multimodal-and-vision-capabilities/image-generation-and-captioning-tools.html">
            
                <a href="../multimodal-and-vision-capabilities/image-generation-and-captioning-tools.html">
            
                    
                    Image Generation and Captioning Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../multimodal-and-vision-capabilities/content-formatting-for-images.html">
            
                <a href="../multimodal-and-vision-capabilities/content-formatting-for-images.html">
            
                    
                    Content Formatting for Images
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../agent-capabilities-and-composability/">
            
                <a href="../agent-capabilities-and-composability/">
            
                    
                    Agent Capabilities and Composability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../agent-capabilities-and-composability/agentcapability-base-class.html">
            
                <a href="../agent-capabilities-and-composability/agentcapability-base-class.html">
            
                    
                    AgentCapability Base Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../agent-capabilities-and-composability/teachability-and-memory.html">
            
                <a href="../agent-capabilities-and-composability/teachability-and-memory.html">
            
                    
                    Teachability and Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../agent-capabilities-and-composability/toolscapability-composition.html">
            
                <a href="../agent-capabilities-and-composability/toolscapability-composition.html">
            
                    
                    ToolsCapability Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../agent-capabilities-and-composability/transformmessages-and-message-transforms.html">
            
                <a href="../agent-capabilities-and-composability/transformmessages-and-message-transforms.html">
            
                    
                    TransformMessages and Message Transforms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../group-and-swarm-agent-patterns/">
            
                <a href="../group-and-swarm-agent-patterns/">
            
                    
                    Group and Swarm Agent Patterns
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../group-and-swarm-agent-patterns/swarmagent-and-afterwork.html">
            
                <a href="../group-and-swarm-agent-patterns/swarmagent-and-afterwork.html">
            
                    
                    SwarmAgent and AfterWork
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../group-and-swarm-agent-patterns/oncondition-and-nested-chat-transitions.html">
            
                <a href="../group-and-swarm-agent-patterns/oncondition-and-nested-chat-transitions.html">
            
                    
                    OnCondition and Nested Chat Transitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../group-and-swarm-agent-patterns/pattern-classes-for-orchestration.html">
            
                <a href="../group-and-swarm-agent-patterns/pattern-classes-for-orchestration.html">
            
                    
                    Pattern Classes for Orchestration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../practical-pitfalls-and-best-practices/">
            
                <a href="../practical-pitfalls-and-best-practices/">
            
                    
                    Practical Pitfalls and Best Practices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../practical-pitfalls-and-best-practices/error-handling-in-agent-orchestration.html">
            
                <a href="../practical-pitfalls-and-best-practices/error-handling-in-agent-orchestration.html">
            
                    
                    Error Handling in Agent Orchestration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../practical-pitfalls-and-best-practices/security-considerations-for-code-execution.html">
            
                <a href="../practical-pitfalls-and-best-practices/security-considerations-for-code-execution.html">
            
                    
                    Security Considerations for Code Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="../practical-pitfalls-and-best-practices/testing-and-logging-strategies.html">
            
                <a href="../practical-pitfalls-and-best-practices/testing-and-logging-strategies.html">
            
                    
                    Testing and Logging Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Querying and Chunking Strategies</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="querying-and-chunking-strategies">Querying and chunking strategies</h1>
<h2 id="overview">Overview</h2>
<p>Retrieval Augmented Generation (RAG) combines traditional information retrieval with generative AI by leveraging vector databases to store and search over embeddings of documents or knowledge sources. Two critical components for effective RAG systems are <strong>querying</strong> (how user questions are transformed and matched against the database) and <strong>chunking</strong> (how documents are split into retrievable units). Optimal strategies for querying and chunking significantly impact search accuracy, efficiency, and the quality of generated responses.</p>
<hr></hr>
<h2 id="explanation">Explanation</h2>
<h3 id="chunking-strategies">Chunking Strategies</h3>
<p><strong>Chunking</strong> refers to dividing large documents into smaller, manageable pieces (chunks) before embedding and storing them in a vector database. The goal is to balance sufficient context per chunk with the need to avoid excessive length (which can hurt retrieval and generation).</p>
<p><strong>Common chunking approaches:</strong></p>
<ul>
<li><strong>Fixed-size chunking:</strong> Split text into segments of fixed word, sentence, or token count (e.g., 512 tokens per chunk).</li>
<li><strong>Semantic chunking:</strong> Split based on semantic boundaries such as paragraphs, headings, or logical sections.</li>
<li><strong>Sliding window:</strong> Overlap chunks by a certain amount to preserve context between them.</li>
</ul>
<p><strong>Why is chunking important?</strong></p>
<ul>
<li>Too large: retrieval may miss relevant information or exceed model context limits.</li>
<li>Too small: loses context, resulting in fragmented or less meaningful retrievals.</li>
</ul>
<h3 id="querying-strategies">Querying Strategies</h3>
<p><strong>Querying</strong> involves transforming the user's question into a vector (embedding) and searching for the most similar chunks in the database. Strategies impact precision, recall, and speed.</p>
<p><strong>Key querying considerations:</strong></p>
<ul>
<li><strong>Embedding model selection:</strong> Use models with strong semantic representation (e.g., OpenAI's <code>text-embedding-ada-002</code>, Cohere, or open-source alternatives).</li>
<li><strong>Query expansion:</strong> Augment queries with synonyms, keywords, or context variables to improve recall.</li>
<li><strong>Conditional logic:</strong> Dynamically adjust queries based on user context or tool outputs (e.g., user role, prior queries).</li>
<li><strong>Tool and function interoperability:</strong> Integrate with external tools or APIs to refine or post-process queries and results.</li>
</ul>
<p><strong>Ranking and Filtering:</strong></p>
<ul>
<li>Many vector databases (e.g., Pinecone, Weaviate, Chroma) support additional metadata filtering, allowing for hybrid search (combining vector similarity and structured filters).</li>
</ul>
<hr></hr>
<h2 id="examples">Examples</h2>
<h3 id="1-chunking-a-document">1. Chunking a Document</h3>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> nltk.tokenize <span class="hljs-keyword">import</span> sent_tokenize

<span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_text</span>(<span class="hljs-params">text, max_tokens=<span class="hljs-number">200</span></span>):
    sentences = sent_tokenize(text)
    chunks = []
    current_chunk = []
    tokens_so_far = <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:
        tokens = sentence.split()
        <span class="hljs-keyword">if</span> tokens_so_far + <span class="hljs-built_in">len</span>(tokens) &gt; max_tokens:
            chunks.append(<span class="hljs-string">' '</span>.join(current_chunk))
            current_chunk = []
            tokens_so_far = <span class="hljs-number">0</span>
        current_chunk.append(sentence)
        tokens_so_far += <span class="hljs-built_in">len</span>(tokens)
    <span class="hljs-keyword">if</span> current_chunk:
        chunks.append(<span class="hljs-string">' '</span>.join(current_chunk))
    <span class="hljs-keyword">return</span> chunks

<span class="hljs-comment"># Example usage</span>
document = <span class="hljs-string">"..."</span>  <span class="hljs-comment"># large document string</span>
chunks = chunk_text(document, max_tokens=<span class="hljs-number">150</span>)
</code></pre>
<h3 id="2-querying-a-vector-database-eg-using-pinecone-and-openai">2. Querying a Vector Database (e.g., using Pinecone and OpenAI)</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> openai
<span class="hljs-keyword">import</span> pinecone

<span class="hljs-comment"># Embed the query</span>
query = <span class="hljs-string">"How can I reset my password?"</span>
query_embedding = openai.Embedding.create(
    model=<span class="hljs-string">"text-embedding-ada-002"</span>,
    <span class="hljs-built_in">input</span>=query
)[<span class="hljs-string">"data"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"embedding"</span>]

<span class="hljs-comment"># Query Pinecone for top 3 matches</span>
pinecone.init(api_key=<span class="hljs-string">"YOUR_API_KEY"</span>, environment=<span class="hljs-string">"us-west1-gcp"</span>)
index = pinecone.Index(<span class="hljs-string">"my-index"</span>)
results = index.query(vector=query_embedding, top_k=<span class="hljs-number">3</span>, include_metadata=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> results[<span class="hljs-string">'matches'</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-keyword">match</span>[<span class="hljs-string">'metadata'</span>][<span class="hljs-string">'text'</span>])
</code></pre>
<h3 id="3-conditional-querying-with-context-variables">3. Conditional Querying with Context Variables</h3>
<pre><code class="lang-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_query</span>(<span class="hljs-params">user_question, context_vars</span>):
    <span class="hljs-keyword">if</span> context_vars.get(<span class="hljs-string">"user_role"</span>) == <span class="hljs-string">"admin"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Admin guide: <span class="hljs-subst">{user_question}</span>"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> user_question

query = build_query(<span class="hljs-string">"How do I add users?"</span>, {<span class="hljs-string">"user_role"</span>: <span class="hljs-string">"admin"</span>})
</code></pre>
<hr></hr>
<h2 id="best-practices">Best Practices</h2>
<ul>
<li><strong>Choose chunk size carefully:</strong> Balance chunk length to preserve context without exceeding embedding model limits.</li>
<li><strong>Prefer semantic chunking:</strong> Use logical boundaries over arbitrary splits where possible.</li>
<li><strong>Deduplicate and clean chunks:</strong> Remove boilerplate or duplicate content before embedding.</li>
<li><strong>Leverage metadata:</strong> Store metadata with each chunk for filtering and contextual ranking.</li>
<li><strong>Monitor embedding and search quality:</strong> Evaluate both retrieval accuracy (precision, recall) and generation quality.</li>
<li><strong>Secure API keys and data:</strong> Ensure sensitive data and credentials are managed appropriately.</li>
</ul>
<p><strong>Common pitfalls:</strong></p>
<ul>
<li>Overlapping chunks too much, leading to redundant retrievals.</li>
<li>Ignoring language nuances (e.g. sentence boundaries) in chunking.</li>
<li>Using mismatched embedding models for queries and documents.</li>
<li>Not updating the index after corpus changes.</li>
</ul>
<hr></hr>
<h2 id="related-concepts">Related Concepts</h2>
<ul>
<li><a href="https://arxiv.org/abs/2005.11401" target="_blank">Retrieval Augmented Generation (RAG)</a></li>
<li><a href="https://www.pinecone.io/learn/vector-database/" target="_blank">Vector Databases</a></li>
<li><a href="https://weaviate.io/developers/weaviate/search/hybrid" target="_blank">Hybrid Search (combining vector and keyword search)</a></li>
<li><a href="https://platform.openai.com/docs/guides/embeddings" target="_blank">Tokenization and Embeddings</a></li>
<li><a href="#">Tool and Function Interoperability</a></li>
<li><a href="#">Context Variables and Conditional Logic</a></li>
<li><a href="https://docs.pinecone.io/docs/metadata-filtering" target="_blank">Metadata Filtering in Vector Search</a></li>
</ul>
<p>For further reading, see the documentation of your chosen vector database (e.g., <a href="https://docs.pinecone.io/" target="_blank">Pinecone</a>, <a href="https://weaviate.io/" target="_blank">Weaviate</a>, <a href="https://docs.trychroma.com/" target="_blank">Chroma</a>).</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chromadb-pgvector-qdrant-mongodb-integrations.html" class="navigation navigation-prev " aria-label="Previous page: ChromaDB PGVector Qdrant MongoDB Integrations">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../structured-outputs-and-tool-calling-with-llms/" class="navigation navigation-next " aria-label="Next page: Structured Outputs and Tool Calling with LLMs">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Querying and Chunking Strategies","level":"1.9.4","depth":2,"next":{"title":"Structured Outputs and Tool Calling with LLMs","level":"1.10","depth":1,"path":"chapters/structured-outputs-and-tool-calling-with-llms/README.md","ref":"chapters/structured-outputs-and-tool-calling-with-llms/README.md","articles":[{"title":"Function and Tool Schemas","level":"1.10.1","depth":2,"path":"chapters/structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.md","ref":"chapters/structured-outputs-and-tool-calling-with-llms/function-and-tool-schemas.md","articles":[]},{"title":"Structured Output Formatting","level":"1.10.2","depth":2,"path":"chapters/structured-outputs-and-tool-calling-with-llms/structured-output-formatting.md","ref":"chapters/structured-outputs-and-tool-calling-with-llms/structured-output-formatting.md","articles":[]},{"title":"Tool Call and Function Call Message Handling","level":"1.10.3","depth":2,"path":"chapters/structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.md","ref":"chapters/structured-outputs-and-tool-calling-with-llms/tool-call-and-function-call-message-handling.md","articles":[]}]},"previous":{"title":"ChromaDB PGVector Qdrant MongoDB Integrations","level":"1.9.3","depth":2,"path":"chapters/retrieval-augmented-generation-and-vector-databases/chromadb-pgvector-qdrant-mongodb-integrations.md","ref":"chapters/retrieval-augmented-generation-and-vector-databases/chromadb-pgvector-qdrant-mongodb-integrations.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-default","highlight"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"AutoGen Team","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Agentic Documentation","language":"en","gitbook":"*"},"file":{"path":"chapters/retrieval-augmented-generation-and-vector-databases/querying-and-chunking-strategies.md","mtime":"2025-05-24T00:01:16.629Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-05-24T00:01:26.122Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

